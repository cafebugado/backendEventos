name: PR para Main

on:
  pull_request:
    branches:
      - main
    types:
      - opened
      - synchronize
      - reopened

jobs:
  validate-branch:
    name: Validar Branch de Origem
    runs-on: ubuntu-latest
    steps:
      - name: Verificar branch de origem
        run: |
          BRANCH="${{ github.head_ref }}"
          echo "Branch de origem: $BRANCH"

          if [[ "$BRANCH" == "developer" ]]; then
            echo "✅ Branch válida para PR em main"
          else
            echo "❌ PRs para main devem vir APENAS da branch developer"
            echo "Fluxo correto: feature/* → developer → main"
            exit 1
          fi

  ci:
    name: CI Checks Completos
    runs-on: ubuntu-latest
    needs: validate-branch
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm install

      - name: Lint
        run: npm run lint

      - name: Testes
        run: npm test

      - name: Build
        run: npm run build
